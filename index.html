<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Python Automation Using Ansible, Fabric, and Supervisor</title><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/impressConsole.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="hovercraft.css" media="screen,projection"></link></head><body class="impress-not-supported"><div id="impress" auto-console="True"><div class="step step-level-1" step="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="0" data-y="0" data-z="0"><h1 id="python-automation">Python Automation</h1><h2 id="using-ansible-fabric-and-supervisor">Using Ansible, Fabric, and Supervisor</h2><p>Jared Ondricek
sdfkjhdsfkjsdhf</p><p><a href="mailto:flamableconcrete@gmail.com">flamableconcrete@gmail.com</a>
<a href="https://github.com/flamableconcrete">https://github.com/flamableconcrete</a></p><p>NOVA-Python 10/27/2016</p></div><div class="step step-level-1" step="1" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="1600" data-y="0" data-z="0"><h1 id="who-am-i">Who am I?</h1><ul><li>The MITRE Corporation</li><li>Python enthusiast</li><li>DevOps junkie</li><li>Android forensics and reverse engineering</li></ul><div class="notes"><ul><li>PyLunch</li></ul></div></div><div class="step step-level-1" step="2" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="3200" data-y="0" data-z="0"><h1 id="how-i-view-this-talk">How I view this Talk</h1><img src="images/lightning-talk.png" width="260px" height="150px"></img><p>Ansible</p><img src="images/lightning-talk.png" width="260px" height="150px"></img><p>Supervisor</p><img src="images/lightning-talk.png" width="260px" height="150px"></img><p>Fabric</p></div><div class="step step-level-1" step="3" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="4800" data-y="0" data-z="0"><h1 id="but-first">But First</h1><img src="images/story-time.jpg" width="800px" height="600px"></img></div><div class="step step-level-1" step="4" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="6400" data-y="0" data-z="0"><h1 id="story-time">Story Time</h1><blockquote><ul><li>Started a new project</li><li>Bash scripts</li><li>Python scripts</li><li>Need a database</li><li>Python module</li></ul></blockquote><div class="notes"><ul><li>Of course it doesn't stop there</li></ul></div></div><div class="step step-level-1" step="5" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="8000" data-y="0" data-z="0"><h1 id="still-story-time">Still Story Time</h1><blockquote><ul><li>Message Queue</li><li>Other apt-get dependencies</li><li>Wrote a Flask web app</li><li>All of a sudden, spaghetti code</li></ul></blockquote></div><div class="step step-level-1" step="6" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="9600" data-y="0" data-z="0"><h1 id="then-someone-asks">Then Someone Asks</h1><img src="images/can-i-have-it.jpg" width="750px" height="450px"></img></div><div class="step step-level-1" step="7" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="11200" data-y="0" data-z="0"><h1 id="your-instructions">Your Instructions</h1><img src="images/process-nice.jpg"></img><div class="notes"><ul><li>You give them nice instructions</li><li>They're pretty</li><li>Easy to follow</li></ul></div></div><div class="step step-level-1" step="8" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="12800" data-y="0" data-z="0"><h1 id="their-interpretation">Their Interpretation</h1><img src="images/spaghetti.jpg"></img></div><div class="step step-level-1" step="9" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="14400" data-y="0" data-z="0"><h1 id="you-want-to-scream">You Want to Scream</h1><img src="images/doesnt-work.jpg" width="600px" height="640px"></img></div><div class="step step-level-1" step="10" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="16000" data-y="0" data-z="0"><h1 id="this-is-why-you-should">This is Why You Should</h1><img src="images/automate-all-the-things.jpg" width="800px" height="600px"></img></div><div class="step step-level-1" step="11" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="17600" data-y="0" data-z="0"><h1 id="ansible">Ansible</h1><ul><li>IT Automation Tool</li><li>Deploys/provisions software onto systems</li><li>Agent-less - ssh only</li><li>Idempotent</li></ul><div class="notes"><ul><li><dl><dt>Agent-less</dt><dd><ul><li>Has anyone used Chef/Salt/Puppet?</li></ul></dd></dl></li><li><dl><dt>Idempotence</dt><dd><ul><li>Idempotence is the property of certain operations that can be applied multiple times without changing the result beyond the initial application.</li><li>In the case of methods or subroutine calls with side effects, the modified state remains the same after the first call.</li></ul></dd></dl></li></ul></div></div><div class="step step-level-1" step="12" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="19200" data-y="0" data-z="0"><h1 id="cowsay-support">Cowsay Support</h1><img src="images/cowsay.png" width="600px" height="400px"></img></div><div class="step step-level-1" step="13" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="20800" data-y="0" data-z="0"><h1 id="how-do-i-get-it">How do I get it?</h1><p>Linux/OS X</p><pre class="highlight code bash">$ sudo pip install ansible</pre><p>Windows</p><ul><li>Cry</li><li>Bash on Windows 10</li><li>Ansible Babun Bootstrap (Github)</li></ul></div><div class="step step-level-1" step="14" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="22400" data-y="0" data-z="0"><h1 id="key-components">Key Components</h1><ul><li><a href="http://docs.ansible.com/ansible/intro_inventory.html">Inventory file</a></li><li><a href="http://docs.ansible.com/ansible/intro_adhoc.html">Ad-hoc commands</a></li><li><a href="http://docs.ansible.com/ansible/intro_configuration.html">Configuration file</a></li><li><a href="http://docs.ansible.com/ansible/playbooks.html">Playbooks</a></li><li><a href="http://docs.ansible.com/ansible/playbooks_roles.html">Roles</a></li><li><a href="http://docs.ansible.com/ansible/modules.html">700+ modules</a></li><li><a href="http://docs.ansible.com/ansible/galaxy.html">Ansible Galaxy</a></li></ul><div class="notes"><ul><li>We will go over these sections on the following slides</li></ul></div></div><div class="step step-level-1" step="15" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="24000" data-y="0" data-z="0"><h1 id="id1"><a href="http://docs.ansible.com/ansible/intro_inventory.html">Inventory File</a></h1><ul><li>Master or local inventory</li><li>INI syntax</li><li>Groups</li></ul><pre class="highlight code">(contents of /etc/ansible/hosts)

mail.example.com

[webservers]
foo.example.com
bar.example.com

[dbservers]
one.example.com
two.example.com
three.example.com</pre></div><div class="step step-level-1" step="16" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="25600" data-y="0" data-z="0"><h1 id="id3"><a href="http://docs.ansible.com/ansible/intro_adhoc.html">Ad-hoc Commands</a></h1><ul><li>One off commands you don't need to save</li></ul><pre class="highlight code bash">$ ansible webservers -a <span class="s2">"touch /home/user/foo.log"</span>
$ ansible mail.example.com -a <span class="s2">"/sbin/reboot"</span> -u username --become -K
$ ansible dbservers -m copy -a <span class="s2">"src=/etc/hosts dest=/tmp/hosts"</span></pre><div class="notes"><ul><li>-a is for ad-hoc command</li><li>--become is for becoming another user, by default sudo</li><li>-K is to ask for sudo password</li><li>-m is to use a module</li></ul></div></div><div class="step step-level-1" step="17" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="27200" data-y="0" data-z="0"><h1 id="id5"><a href="http://docs.ansible.com/ansible/intro_configuration.html">Configuration File</a></h1><ul><li>ansible.cfg (Master or local)</li><li>Pre-set custom inventory</li><li>Pre-set flags</li><li>Convenient for sudo</li></ul></div><div class="step step-level-1" step="18" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="28800" data-y="0" data-z="0"><h1 id="id7"><a href="http://docs.ansible.com/ansible/playbooks.html">Playbooks</a></h1><ul><li>Infrastructure as code</li><li>YAML syntax</li><li>Replace &lt;<em>deploy</em> | <em>install</em> | <em>configure</em>&gt;.sh</li><li>Look at some <a href="https://github.com/ansible/ansible-examples">examples</a></li><li>Usage:</li></ul><pre class="highlight code bash">$ ansible-playbook playbook.yml</pre><div class="notes"><ul><li>language_features/mysql.yml</li><li>language_features/rabbitmq.yml</li><li>language_features/get_url.yml</li></ul></div></div><div class="step step-level-1" step="19" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="30400" data-y="0" data-z="0"><h1 id="id9"><a href="http://docs.ansible.com/ansible/playbooks_roles.html">Roles</a></h1><ul><li>Playbook management</li><li>roles directory</li><li>Common <a href="http://docs.ansible.com/ansible/playbooks_roles.html#roles">structure</a></li><li>Follow <a href="http://docs.ansible.com/ansible/playbooks_best_practices.html">Best Practices</a></li><li>Look at <a href="https://github.com/ansible/ansible-examples">examples</a> again</li></ul><div class="notes"><ul><li>wordpress-nginx is straightforward</li></ul></div></div><div class="step step-level-1" step="20" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="32000" data-y="0" data-z="0"><h1 id="id12"><a href="http://docs.ansible.com/ansible/modules.html">700+ Modules</a></h1><ul><li><dl><dt>Modules for everything!</dt><dd><ul><li>Cloud!</li><li>Infrastructure!</li><li>Database!</li><li>Packaging!</li><li>Python! (virtualenvs, django, etc.)</li></ul></dd></dl></li><li><dl><dt>Google: ansible ___</dt><dd><ul><li>copy, template, rabbitmq, etc.</li></ul></dd></dl></li></ul><div class="notes"><ul><li>Specific modules will depend on what you are trying to do</li></ul></div></div><div class="step step-level-1" step="21" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="33600" data-y="0" data-z="0"><h1 id="id14"><a href="http://docs.ansible.com/ansible/galaxy.html">Ansible Galaxy</a></h1><ul><li>User contributed roles</li><li>ansible-galaxy command</li></ul></div><div class="step step-level-1" step="22" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="35200" data-y="0" data-z="0"><h1 id="edx"><a href="https://www.edx.org">edX</a></h1><ul><li>Just one example in real life</li><li>edX.org provides free online courses from some major universities</li><li><a href="https://github.com/edx/configuration">https://github.com/edx/configuration</a></li></ul></div><div class="step step-level-1" step="23" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="36800" data-y="0" data-z="0"><h1 id="what-s-next">What's Next?</h1><ul><li>You've installed a bunch of stuff</li><li>Is any of it running?</li><li>Check manually</li><li>Monitor processes</li><li><a href="http://supervisord.org">Supervisor</a>!</li></ul></div><div class="step step-level-1" step="24" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="38400" data-y="0" data-z="0"><h1 id="id17">Supervisor</h1><ul><li>Let's you control and monitor process state on UNIX-like systems</li><li>A program that runs other programs</li></ul></div><div class="step step-level-1" step="25" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="40000" data-y="0" data-z="0"><h1 id="components">Components</h1><ul><li><dl><dt>supervisord</dt><dd><ul><li>should run automatically on startup</li></ul></dd></dl></li><li><dl><dt>supervisorctl</dt><dd><ul><li>CLI</li></ul></dd></dl></li><li>supervisord.conf</li></ul></div><div class="step step-level-1" step="26" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="41600" data-y="0" data-z="0"><h1 id="installation">Installation</h1><pre class="highlight code bash">$ sudo apt-get install supervisor
$ sudo yum install supervisor
$ sudo pip install supervisor</pre><p>Gotcha: if you pip install, it is on you to (auto)start the supervisord process</p></div><div class="step step-level-1" step="27" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="43200" data-y="0" data-z="0"><h1 id="configuration-file-driven">Configuration File Driven</h1><p>The config file can define the set of programs that must be run in</p><ul><li>a development environment</li><li>a production environment</li></ul><p>for a single project</p></div><div class="step step-level-1" step="28" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="44800" data-y="0" data-z="0"><p>Manage processes through:</p><ul><li>Command line tool (supervisorctl)</li><li>Web interface</li><li>XML-RPC</li></ul></div><div class="step step-level-1" step="29" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="46400" data-y="0" data-z="0"><p>Config file sections of note are "include" and "program". Let's take a look at the <a href="http://supervisord.org/configuration.html#program-x-section-settings">docs</a></p><p>Enable the [inet_http_server] if you want the web interface.</p></div><div class="step step-level-1" step="30" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="48000" data-y="0" data-z="0"><p>Processes that Supervisor controls must run in foreground - can't be daemonized.</p><p>Multiple programs can be put in process groups to manage simultaneously.</p></div><div class="step step-level-1" step="31" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="49600" data-y="0" data-z="0"><p>Great. Now you've told Supervisor to do something. Is it doing it?</p><img src="images/supervisor-web.png"></img></div><div class="step step-level-1" step="32" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="51200" data-y="0" data-z="0"><h1 id="supervisorctl">supervisorctl</h1><ul><li>help</li><li>status</li><li>start</li><li>stop</li><li>tail</li></ul></div><div class="step step-level-1" step="33" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="52800" data-y="0" data-z="0"><p>Always good to check the logs if your process isn't starting, or frequently restarting.</p></div><div class="step step-level-1" step="34" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="54400" data-y="0" data-z="0"><p>Ansible can be used to install Supervisor, then add programs that are managed by it. It is also used in some Docker containers to run multiple processes instead of just one.</p></div><div class="step step-level-1" step="35" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="56000" data-y="0" data-z="0"><h1 id="demo">DEMO</h1></div><div class="step step-level-1" step="36" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="57600" data-y="0" data-z="0"><h1 id="what-about-fabric">What about <a href="http://www.fabfile.org/">Fabric</a>?</h1></div><div class="step step-level-1" step="37" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="59200" data-y="0" data-z="0"><p>Python 2 library for automating and streamlining app deployment over ssh. A little overlap with Ansible, but still useful.</p></div></div><div id="hovercraft-help"><table><tr><th>Space</th><td>Forward</td></tr><tr><th>Right, Down, Page Down</th><td>Next slide</td></tr><tr><th>Left, Up, Page Up</th><td>Previous slide</td></tr><tr><th>P</th><td>Open presenter console</td></tr><tr><th>H</th><td>Toggle this help</td></tr></table></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/impressConsole.js"></script><script type="text/javascript" src="js/hovercraft.js"></script></body></html>